<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>YiYing’s sharing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="独立之精神,自由之思想">
<meta property="og:type" content="website">
<meta property="og:title" content="YiYing’s sharing">
<meta property="og:url" content="http://muchstudy.com/page/15/index.html">
<meta property="og:site_name" content="YiYing’s sharing">
<meta property="og:description" content="独立之精神,自由之思想">
<meta property="og:locale">
<meta property="article:author" content="YiYing">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="YiYing’s sharing" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">YiYing’s sharing</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://muchstudy.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-设计模式系列之五工厂模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/06/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%BA%94%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time datetime="2016-12-06T15:14:42.000Z" itemprop="datePublished">2016-12-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/06/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%BA%94%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/">设计模式系列之五工厂模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Java实现"><a href="#Java实现" class="headerlink" title="Java实现"></a>Java实现</h2><h3 id="简单工厂"><a href="#简单工厂" class="headerlink" title="简单工厂"></a>简单工厂</h3><p>&emsp;&emsp;简单工厂应该是最简单的工厂方法了，也是最常见的。下面，通过代码就知道为什么这么说了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimplePizzaFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">		Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (type.equals(<span class="string">&quot;cheese&quot;</span>)) &#123;</span><br><span class="line">			pizza = <span class="keyword">new</span> CheesePizza();</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">&quot;pepperoni&quot;</span>)) &#123;</span><br><span class="line">			pizza = <span class="keyword">new</span> PepperoniPizza();</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">&quot;clam&quot;</span>)) &#123;</span><br><span class="line">			pizza = <span class="keyword">new</span> ClamPizza();</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">&quot;veggie&quot;</span>)) &#123;</span><br><span class="line">			pizza = <span class="keyword">new</span> VeggiePizza();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> pizza;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaStore</span> </span>&#123;</span><br><span class="line">	SimplePizzaFactory factory;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PizzaStore</span><span class="params">(SimplePizzaFactory factory)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.factory = factory;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Pizza <span class="title">orderPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">		Pizza pizza;</span><br><span class="line">		<span class="comment">//通过简单工厂创建不同类型的披萨</span></span><br><span class="line">		pizza = factory.createPizza(type);</span><br><span class="line"></span><br><span class="line">		pizza.prepare();</span><br><span class="line">		pizza.bake();</span><br><span class="line">		pizza.cut();</span><br><span class="line">		pizza.box();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> pizza;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;通过简单工厂方法，有效的把<code>new Object()</code>解耦了出来。在实际的业务中，不用再去关心如何去创建对象。特别是对象的创建与初始化很复杂，且有很多地方都需要用到该对象时，就不用每个地方都去显示的new一下，要修改初始化条件时，也只需要修改工厂方法即可。</p>
<h3 id="工厂方法"><a href="#工厂方法" class="headerlink" title="工厂方法"></a>工厂方法</h3><p>定义：</p>
<blockquote>
<p><strong>工厂方法模式：</strong>定义了一个创建对象的接口，但由子类决定要实例化的类是哪一个。工厂方法让类把实例化推迟到子类。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaStore</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//具体如何创建披萨交由子类去实现（注意对比这里跟简单工厂的区别）</span></span><br><span class="line">	<span class="function"><span class="keyword">abstract</span> Pizza <span class="title">createPizza</span><span class="params">(String item)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Pizza <span class="title">orderPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">		Pizza pizza = createPizza(type);</span><br><span class="line">		System.out.println(<span class="string">&quot;--- Making a &quot;</span> + pizza.getName() + <span class="string">&quot; ---&quot;</span>);</span><br><span class="line">		pizza.prepare();</span><br><span class="line">		pizza.bake();</span><br><span class="line">		pizza.cut();</span><br><span class="line">		pizza.box();</span><br><span class="line">		<span class="keyword">return</span> pizza;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//纽约风格的披萨</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NYPizzaStore</span> <span class="keyword">extends</span> <span class="title">PizzaStore</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">Pizza <span class="title">createPizza</span><span class="params">(String item)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (item.equals(<span class="string">&quot;cheese&quot;</span>)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> NYStyleCheesePizza();</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.equals(<span class="string">&quot;veggie&quot;</span>)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> NYStyleVeggiePizza();</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.equals(<span class="string">&quot;clam&quot;</span>)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> NYStyleClamPizza();</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.equals(<span class="string">&quot;pepperoni&quot;</span>)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> NYStylePepperoniPizza();</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//芝加哥风格的披萨</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChicagoPizzaStore</span> <span class="keyword">extends</span> <span class="title">PizzaStore</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">Pizza <span class="title">createPizza</span><span class="params">(String item)</span> </span>&#123;</span><br><span class="line">        	<span class="keyword">if</span> (item.equals(<span class="string">&quot;cheese&quot;</span>)) &#123;</span><br><span class="line">            		<span class="keyword">return</span> <span class="keyword">new</span> ChicagoStyleCheesePizza();</span><br><span class="line">        	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.equals(<span class="string">&quot;veggie&quot;</span>)) &#123;</span><br><span class="line">        	    	<span class="keyword">return</span> <span class="keyword">new</span> ChicagoStyleVeggiePizza();</span><br><span class="line">        	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.equals(<span class="string">&quot;clam&quot;</span>)) &#123;</span><br><span class="line">        	    	<span class="keyword">return</span> <span class="keyword">new</span> ChicagoStyleClamPizza();</span><br><span class="line">        	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.equals(<span class="string">&quot;pepperoni&quot;</span>)) &#123;</span><br><span class="line">            		<span class="keyword">return</span> <span class="keyword">new</span> ChicagoStylePepperoniPizza();</span><br><span class="line">        	&#125; <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="抽象工厂"><a href="#抽象工厂" class="headerlink" title="抽象工厂"></a>抽象工厂</h3><p>&emsp;&emsp;在所有的工厂模式中，还有一种叫抽象工厂模式。不过一直无法理解抽象工厂模式的具体使用场景，所以这部分留着今后对抽象工厂模式理解深刻了再来总结吧。</p>
<h2 id="Javascript实现"><a href="#Javascript实现" class="headerlink" title="Javascript实现"></a>Javascript实现</h2><h3 id="简单工厂-1"><a href="#简单工厂-1" class="headerlink" title="简单工厂"></a>简单工厂</h3><p>&emsp;&emsp;举一个如下的业务场景：需要开发一个表单生成器，需要做到表单元素的自动生成。那么，可以采用简单工厂来创建表单元素对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">SampleFormFactory</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    SampleFormFactory.fn = SampleFormFactory.prototype;</span><br><span class="line">    SampleFormFactory.fn.getFormElement = <span class="function"><span class="keyword">function</span> (<span class="params">type</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (type)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;Input&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Input();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;Select&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Select();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;Textarea&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Textarea();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;Radio&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Radio();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;Checkbox&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Checkbox();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*****************标准表单对象*****************/</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Input</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Select</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Textarea</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Radio</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Checkbox</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用简单工厂创建表单元素</span></span><br><span class="line">    <span class="keyword">var</span> factory = <span class="keyword">new</span> SampleFormFactory();</span><br><span class="line">    <span class="keyword">var</span> element = factory.getFormElement(<span class="string">&quot;Input&quot;</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;至于在javascript中工厂方法模式的使用，一时想不到使用场景，感觉有点为了用设计模式而设计模式，所以这里就不再举例了。  </p>
<p>上一篇：<a href="http://muchstudy.com/2016/12/02/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E5%9B%9B%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F/">设计模式系列之四装饰者模式</a><br>下一篇：<a href="http://muchstudy.com/2016/12/10/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E5%85%AD%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/">设计模式系列之六命令模式</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://muchstudy.com/2016/12/06/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%BA%94%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" data-id="cm5tqeeub002wwayp8wjj4ntl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-设计模式系列之四装饰者模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/02/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E5%9B%9B%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time datetime="2016-12-02T15:31:10.000Z" itemprop="datePublished">2016-12-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/02/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E5%9B%9B%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F/">设计模式系列之四装饰者模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>装饰者模式的定义：</p>
<blockquote>
<p><strong>装饰者模式：</strong>动态的将责任附加到对象上。若要扩展功能，装饰者提供了比继承更有弹性的替代方案。</p>
</blockquote>
<h2 id="Java实现"><a href="#Java实现" class="headerlink" title="Java实现"></a>Java实现</h2><p>&emsp;&emsp;借用《Head First设计模式》 中的咖啡店卖咖啡的样例。便于说明，这里简洁一下。假如我要写一个咖啡点单计价的软件。业务逻辑是这样的，一杯咖啡10元，如果加糖另外加1元，如果加奶另外加两元。实际来讲，采用硬编码的方式我可以写三个类来实现该需求：1.咖啡单买；2.咖啡+糖；3.咖啡+奶。然后就完事儿，任务完成。但是如果哪一天，老板打算卖即加糖又加奶的咖啡的话，就得再增加一个类来实现该类型咖啡的计价。这还好说，假如我有多种类型的咖啡呢？而且每种类型的咖啡都可以加奶或者糖，这样排列组合下去，我估计要写吐血…..</p>
<p>下面，我们就使用装饰者模式来解决该问题。</p>
<h3 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h3><p> 首先来一个咖啡的抽象类<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbsCoffee</span> </span>&#123;</span><br><span class="line">	<span class="comment">//咖啡描述</span></span><br><span class="line">	String description = <span class="string">&quot;Unknown Type&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> description;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//咖啡加个</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">double</span> <span class="title">cost</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p> 接下来两种咖啡的实现<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MochaCoffee</span> <span class="keyword">extends</span> <span class="title">AbsCoffee</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MochaCoffee</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		description = <span class="string">&quot;摩卡咖啡&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">cost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//摩卡咖啡10元一杯</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LatteCoffee</span> <span class="keyword">extends</span> <span class="title">AbsCoffee</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LatteCoffee</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		description = <span class="string">&quot;拿铁咖啡&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">cost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//拿铁咖啡15元一杯</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">15</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>装饰器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//装饰器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Decorator</span> <span class="keyword">extends</span> <span class="title">AbsCoffee</span> </span>&#123;</span><br><span class="line">	<span class="comment">//强制装饰者增加自己的描述信息</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">getDescription</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>两个装饰类，这里分别为咖啡的调调：糖、牛奶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sugar</span> <span class="keyword">extends</span> <span class="title">Decorator</span></span>&#123;</span><br><span class="line">	AbsCoffee coffee;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Sugar</span><span class="params">(AbsCoffee coffee)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.coffee = coffee;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> coffee.getDescription()+<span class="string">&quot;+糖&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">cost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> coffee.cost()+<span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Milk</span> <span class="keyword">extends</span> <span class="title">Decorator</span></span>&#123;</span><br><span class="line">	AbsCoffee coffee;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Milk</span><span class="params">(AbsCoffee coffee)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.coffee = coffee;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> coffee.getDescription()+<span class="string">&quot;+牛奶&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">cost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> coffee.cost()+<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="comment">//摩卡咖啡</span></span><br><span class="line">		AbsCoffee coffee = <span class="keyword">new</span> MochaCoffee();</span><br><span class="line">		<span class="comment">//打印：摩卡咖啡=10.0</span></span><br><span class="line">		System.out.println(coffee.getDescription()+<span class="string">&quot;=&quot;</span>+coffee.cost());</span><br><span class="line">		<span class="comment">//摩卡+糖+牛奶</span></span><br><span class="line">		coffee = <span class="keyword">new</span> Milk(<span class="keyword">new</span> Sugar(coffee));</span><br><span class="line">		<span class="comment">//打印：摩卡咖啡+糖+牛奶=13.0</span></span><br><span class="line">		System.out.println(coffee.getDescription()+<span class="string">&quot;=&quot;</span>+coffee.cost());</span><br><span class="line">		<span class="comment">/*同理，可以把不同类型的咖啡与不同类型的调料任意组合，解决了硬编码时一种组合就需要对应写一套逻辑的尴尬*/</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="java-io中的装饰者模式"><a href="#java-io中的装饰者模式" class="headerlink" title="java.io中的装饰者模式"></a>java.io中的装饰者模式</h3><p>这里的代码样例来自与《Head First设计模式》一书，演示了<code>FileInputStream</code>中装饰者模式的使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实现字符的大小写转换</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LowerCaseInputStream</span> <span class="keyword">extends</span> <span class="title">FilterInputStream</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LowerCaseInputStream</span><span class="params">(InputStream in)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(in);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> c = in.read();</span><br><span class="line">		<span class="keyword">return</span> (c == -<span class="number">1</span> ? c : Character.toLowerCase((<span class="keyword">char</span>)c));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">(<span class="keyword">byte</span>[] b, <span class="keyword">int</span> offset, <span class="keyword">int</span> len)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> result = in.read(b, offset, len);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = offset; i &lt; offset+result; i++) &#123;</span><br><span class="line">			b[i] = (<span class="keyword">byte</span>)Character.toLowerCase((<span class="keyword">char</span>)b[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InputTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> c;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//层层装饰，最终输入大写字符</span></span><br><span class="line">			InputStream in =</span><br><span class="line">				<span class="keyword">new</span> LowerCaseInputStream(</span><br><span class="line">					<span class="keyword">new</span> BufferedInputStream(</span><br><span class="line">						<span class="keyword">new</span> FileInputStream(<span class="string">&quot;test.txt&quot;</span>)));</span><br><span class="line"></span><br><span class="line">			<span class="keyword">while</span>((c = in.read()) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">				System.out.print((<span class="keyword">char</span>)c);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			in.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Javascript实现"><a href="#Javascript实现" class="headerlink" title="Javascript实现"></a>Javascript实现</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">MochaCoffee</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.description = <span class="string">&quot;摩卡咖啡&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    MochaCoffee.prototype.cost = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    MochaCoffee.prototype.getDescription = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.description;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调料：糖</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Sugar</span>(<span class="params">coffee</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.coffee         = coffee;</span><br><span class="line">        <span class="built_in">this</span>.description    = <span class="string">&quot;糖&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Sugar.prototype.cost = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.coffee.cost()+<span class="number">1</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    Sugar.prototype.getDescription = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.coffee.getDescription()+<span class="string">&quot;+&quot;</span>+<span class="built_in">this</span>.description</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//调料：牛奶</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Milk</span>(<span class="params">coffee</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.coffee         = coffee;</span><br><span class="line">        <span class="built_in">this</span>.description    = <span class="string">&quot;牛奶&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Milk.prototype.cost = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.coffee.cost()+<span class="number">2</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    Milk.prototype.getDescription = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.coffee.getDescription()+<span class="string">&quot;+&quot;</span>+<span class="built_in">this</span>.description</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*************************测试代码*************************/</span></span><br><span class="line">    <span class="keyword">var</span> coffee  = <span class="keyword">new</span> MochaCoffee();</span><br><span class="line">    <span class="comment">//这里将打印：摩卡咖啡=10</span></span><br><span class="line">    <span class="built_in">console</span>.log(coffee.getDescription()+<span class="string">&quot;=&quot;</span>+coffee.cost());</span><br><span class="line">    coffee      = <span class="keyword">new</span> Milk(<span class="keyword">new</span> Sugar(coffee));</span><br><span class="line">    <span class="comment">//这里将打印：摩卡咖啡+糖+牛奶=13</span></span><br><span class="line">    <span class="built_in">console</span>.log(coffee.getDescription()+<span class="string">&quot;=&quot;</span>+coffee.cost());</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上一篇：<a href="http://muchstudy.com/2016/11/29/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%B8%89%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/">设计模式系列之三观察者模式</a><br>下一篇：<a href="http://muchstudy.com/2016/12/06/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%BA%94%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/">设计模式系列之五工厂模式</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://muchstudy.com/2016/12/02/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E5%9B%9B%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F/" data-id="cm5tqeeua002twaypfayacz91" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-设计模式系列之三观察者模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/29/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%B8%89%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time datetime="2016-11-29T13:01:37.000Z" itemprop="datePublished">2016-11-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/29/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%B8%89%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/">设计模式系列之三观察者模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>先来看看观察者模式的定义</p>
<blockquote>
<p><strong>观察者模式：</strong>定义了对象之间的一对多依赖，这样一来，当一个对象改变状态时，它的所有依赖者都会收到通知并自动更新。</p>
</blockquote>
<h2 id="Java实现"><a href="#Java实现" class="headerlink" title="Java实现"></a>Java实现</h2><p>下面以消息中心的需求作为例子。有一个消息中心，当消息中心收到新消息时，动态通知所有的收听者。</p>
<h3 id="消息中心部分"><a href="#消息中心部分" class="headerlink" title="消息中心部分"></a>消息中心部分</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">	<span class="comment">//- 注册收听者</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(Observer o)</span></span>;</span><br><span class="line">	<span class="comment">//- 移除收听者</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeObserver</span><span class="params">(Observer o)</span></span>;</span><br><span class="line">	<span class="comment">//- 通知收听者</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageCenter</span> <span class="keyword">implements</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> ArrayList&lt;Observer&gt; observers;</span><br><span class="line">	<span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MessageCenter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//- 保存所有的收听者</span></span><br><span class="line">		observers = <span class="keyword">new</span> ArrayList&lt;Observer&gt;();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(Observer o)</span> </span>&#123;</span><br><span class="line">		observers.add(o);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeObserver</span><span class="params">(Observer o)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> i = observers.indexOf(o);</span><br><span class="line">		<span class="keyword">if</span> (i &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">			observers.remove(i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通知所有人</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (Observer observer : observers) &#123;</span><br><span class="line">			observer.printMessage(message);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 收到新消息触发</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">newMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		notifyObservers();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//模拟收到消息</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.message = message;</span><br><span class="line">		newMessage();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="收听者部分"><a href="#收听者部分" class="headerlink" title="收听者部分"></a>收听者部分</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMessage</span><span class="params">(String message)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserOne</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Subject messageCenter;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UserOne</span><span class="params">(Subject messageCenter)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.messageCenter = messageCenter;</span><br><span class="line">		<span class="keyword">this</span>.messageCenter.registerObserver(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;UserOne:&quot;</span>+message);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserTwo</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Subject messageCenter;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UserTwo</span><span class="params">(Subject messageCenter)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.messageCenter = messageCenter;</span><br><span class="line">		<span class="keyword">this</span>.messageCenter.registerObserver(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;UserTwo:&quot;</span>+message);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		MessageCenter messageCenter = <span class="keyword">new</span> MessageCenter();</span><br><span class="line">		UserOne one = <span class="keyword">new</span> UserOne(messageCenter);</span><br><span class="line">		UserTwo two = <span class="keyword">new</span> UserTwo(messageCenter);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//这里One和Two都能收到消息</span></span><br><span class="line">		messageCenter.setMessage(<span class="string">&quot;First Message!&quot;</span>);</span><br><span class="line">		<span class="comment">//移除用户One</span></span><br><span class="line">		messageCenter.removeObserver(one);</span><br><span class="line">		<span class="comment">//这里就只有UserTwo能收到消息了</span></span><br><span class="line">		messageCenter.setMessage(<span class="string">&quot;Second Message!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="JavaScript实现"><a href="#JavaScript实现" class="headerlink" title="JavaScript实现"></a>JavaScript实现</h2><p>在javascript中，最常见的例子就是jquery中的自定义事件,当事件触发时，会通知所有的事件收听者。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;ButtonID&quot;</span>&gt;</span>Button<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../jquery/jquery-2.1.3.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> $btn = $(<span class="string">&quot;#ButtonID&quot;</span>);</span></span><br><span class="line"><span class="javascript">    $btn.bind(<span class="string">&quot;CustomEvent&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">event,param</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;我是收听者One&quot;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(param);</span></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="javascript">    $btn.bind(<span class="string">&quot;CustomEvent&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">event,param</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;我是收听者Two&quot;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(param);</span></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="javascript">    <span class="comment">//执行此段代码，触发事件。在控制台上可以看到One和Two同时被打印出来了</span></span></span><br><span class="line"><span class="javascript">    $btn.trigger(<span class="string">&quot;CustomEvent&quot;</span>,<span class="string">&quot;给收听者的通知&quot;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">MessageCenter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.observers  = &#123;&#125;;</span><br><span class="line">        <span class="built_in">this</span>.newMessage = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    MessageCenter.fn = MessageCenter.prototype;</span><br><span class="line">    <span class="comment">//注册收听者</span></span><br><span class="line">    MessageCenter.fn.registerObserver = <span class="function"><span class="keyword">function</span> (<span class="params">id,observer</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.observers[id] = observer;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//移除收听者</span></span><br><span class="line">    MessageCenter.fn.removeObserver = <span class="function"><span class="keyword">function</span> (<span class="params">id</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> <span class="built_in">this</span>.observers[id];</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//通知所有收听者</span></span><br><span class="line">    MessageCenter.fn.notifyObservers = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> <span class="built_in">this</span>.observers)&#123;</span><br><span class="line">            <span class="built_in">this</span>.observers[key].apply(<span class="built_in">this</span>,[<span class="built_in">this</span>.newMessage]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//模拟收到新消息</span></span><br><span class="line">    MessageCenter.fn.setMessage = <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.newMessage = msg;</span><br><span class="line">        <span class="built_in">this</span>.notifyObservers();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 收听者UserOne</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="variable">subject</span></span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@constructor</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">UserOne</span>(<span class="params">subject</span>) </span>&#123;</span><br><span class="line">        subject.registerObserver(<span class="string">&quot;UserOne&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;我是UserOne，我收到的消息是:&quot;</span>+msg);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 收听者UserTwo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="variable">subject</span></span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@constructor</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">UserTwo</span>(<span class="params">subject</span>) </span>&#123;</span><br><span class="line">        subject.registerObserver(<span class="string">&quot;UserTwo&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;我是UserTwo，我收到的消息是:&quot;</span>+msg);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//测试代码</span></span><br><span class="line">    <span class="keyword">var</span> msgCenter = <span class="keyword">new</span> MessageCenter();</span><br><span class="line">    <span class="keyword">new</span> UserOne(msgCenter);</span><br><span class="line">    <span class="keyword">new</span> UserTwo(msgCenter);</span><br><span class="line">    <span class="comment">//这里One和Two都能收到消息</span></span><br><span class="line">    msgCenter.setMessage(<span class="string">&quot;First Message!&quot;</span>);</span><br><span class="line">    <span class="comment">//移除UserOne</span></span><br><span class="line">    msgCenter.removeObserver(<span class="string">&quot;UserOne&quot;</span>);</span><br><span class="line">    <span class="comment">//这里就只有UserTwo能收到消息了</span></span><br><span class="line">    msgCenter.setMessage(<span class="string">&quot;Second Message!&quot;</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>上一篇：<a href="http://muchstudy.com/2016/11/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%BA%8C%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/">设计模式系列之二策略模式</a><br>下一篇：<a href="http://muchstudy.com/2016/12/02/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E5%9B%9B%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F/">设计模式系列之四装饰者模式</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://muchstudy.com/2016/11/29/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%B8%89%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/" data-id="cm5tqeeu9002qwayp0g150vij" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-设计模式系列之二策略模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%BA%8C%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time datetime="2016-11-28T15:50:40.000Z" itemprop="datePublished">2016-11-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%BA%8C%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/">设计模式系列之二策略模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Java实现"><a href="#Java实现" class="headerlink" title="Java实现"></a>Java实现</h2><p> 有如下需求，明天周一，需要去公司上班，目前从家里到公司有两种策略，一种是公交，一种是地铁。下面就来实现一下  </p>
<h3 id="定义具体策略"><a href="#定义具体策略" class="headerlink" title="定义具体策略"></a>定义具体策略</h3> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IStrategy</span> </span>&#123;</span><br><span class="line">	<span class="comment">//对策略的描述</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">description</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bus</span> <span class="keyword">implements</span> <span class="title">IStrategy</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">description</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		System.out.println(<span class="string">&quot;乘公交去上班&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Subway</span> <span class="keyword">implements</span> <span class="title">IStrategy</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">description</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		System.out.println(<span class="string">&quot;乘地铁去上班&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="最简单的策略调用"><a href="#最简单的策略调用" class="headerlink" title="最简单的策略调用"></a>最简单的策略调用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoToWork</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myStrategy</span><span class="params">(String strategy)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="string">&quot;bus&quot;</span>.equals(strategy))&#123;</span><br><span class="line">			<span class="keyword">new</span> Bus().description();</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;subway&quot;</span>.endsWith(strategy))&#123;</span><br><span class="line">			<span class="keyword">new</span> Subway().description();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		GoToWork gotowork = <span class="keyword">new</span> GoToWork();</span><br><span class="line">		gotowork.myStrategy(<span class="string">&quot;bus&quot;</span>);</span><br><span class="line">		gotowork.myStrategy(<span class="string">&quot;subway&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>从上面的代码中可以看出，通过<code>if else</code>的使用实现了简单的策略模式。但是，假如有一天我买车了，可以自己开车去上班了。这个时候就需要对<code>GoToWork</code>类做修改，需要再加一个<code>else if</code>判断来实现需求。这样就造成了代码的紧耦合。那么，有没有办法解耦，不但能让我开车，甚至开飞机上班都不用修改<code>GoToWork</code>类呢？</p>
</blockquote>
<h3 id="改造"><a href="#改造" class="headerlink" title="改造"></a>改造</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoToWork</span> </span>&#123;</span><br><span class="line">	<span class="comment">//保存策略的引用</span></span><br><span class="line">	<span class="keyword">private</span> IStrategy strategy;</span><br><span class="line">	<span class="comment">//可动态设置策略</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStrategy</span><span class="params">(IStrategy strategy)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.strategy = strategy;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myStrategy</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//这里实现了对策略的动态调用</span></span><br><span class="line">		<span class="keyword">this</span>.strategy.description();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		GoToWork work = <span class="keyword">new</span> GoToWork();</span><br><span class="line">		<span class="comment">//乘公交上班</span></span><br><span class="line">		work.setStrategy(<span class="keyword">new</span> Bus());</span><br><span class="line">		work.myStrategy();</span><br><span class="line">		<span class="comment">//乘地铁上班</span></span><br><span class="line">		work.setStrategy(<span class="keyword">new</span> Subway());</span><br><span class="line">		work.myStrategy();</span><br><span class="line">	    <span class="comment">//开车上班</span></span><br><span class="line">	    <span class="comment">//work.setStrategy(new Car());</span></span><br><span class="line">	    <span class="comment">//work.myStrategy();</span></span><br><span class="line">	    <span class="comment">/*.....还可增加任意策略.....*/</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以看到，对<code>GoToWork</code>类做完改造后，即满足了我们的需求。</p>
</blockquote>
<h2 id="JavaScript实现"><a href="#JavaScript实现" class="headerlink" title="JavaScript实现"></a>JavaScript实现</h2><p> 之前写表格组件，有一个表格行可编辑的需求。开发人员在使用表格组件时可选择单元格的编辑类型：文本框、下拉框、单选按钮等。并且，为了灵活性，还需要能够让开发人员自定义类型，比如在表格的单元格中日期选择、弹出框选择等。针对该需求，策略模式派上了用场。</p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">W</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> singleton  = <span class="literal">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Grid</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.config = &#123;</span><br><span class="line">            pagination:<span class="literal">true</span></span><br><span class="line">        &#125;;</span><br><span class="line">        init(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//表格初始化</span></span><br><span class="line">    <span class="keyword">var</span> init = <span class="function"><span class="keyword">function</span> (<span class="params">G</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $table = $(<span class="string">&quot;&lt;table&gt;&lt;/table&gt;&quot;</span>);</span><br><span class="line">        G.$Container = $(<span class="string">&quot;#&quot;</span>+<span class="built_in">this</span>.placeAt).empty().append($table);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//设置表格配置</span></span><br><span class="line">    Grid.prototype.setConfig = <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.config = $.extend(<span class="built_in">this</span>.config,config);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//添加行</span></span><br><span class="line">    Grid.prototype.addRow = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $tr = $(<span class="string">&quot;&lt;tr&gt;&lt;/tr&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> len = <span class="built_in">this</span>.config.layout.length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">            <span class="keyword">var</span> $td = $(<span class="string">&quot;&lt;td&gt;&lt;/td&gt;&quot;</span>);</span><br><span class="line">            <span class="keyword">new</span> Cell($td,<span class="built_in">this</span>.config.layout[i]);</span><br><span class="line">            $tr.append($td);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.$Container.append($tr);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//删除行</span></span><br><span class="line">    Grid.prototype.deleteRow = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//单例模式使用</span></span><br><span class="line">    W.Grid.getInstance = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(singleton===<span class="literal">null</span>)&#123;</span><br><span class="line">            singleton = <span class="keyword">new</span> Grid();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//单元格对象</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span>  <span class="title">Cell</span>(<span class="params">$container,config</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.$Container = $container;</span><br><span class="line">        <span class="built_in">this</span>.config     = config;</span><br><span class="line">        <span class="built_in">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line">    Cell.fn = Cell.prototype;</span><br><span class="line"></span><br><span class="line">    Cell.fn.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.config.editor)&#123;</span><br><span class="line">            <span class="built_in">this</span>._editor = <span class="built_in">this</span>.edit();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>._editor = <span class="built_in">this</span>.read();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//单元格只读</span></span><br><span class="line">    Cell.fn.read = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//使用默认策略渲染单元格</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Forms[<span class="string">&quot;Span&quot;</span>](<span class="built_in">this</span>.$Container,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//单元格自定义与已有表单对象渲染</span></span><br><span class="line">    Cell.fn.edit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> formObj = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">var</span> type    = <span class="built_in">this</span>.config.editor.type;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span>(type)==<span class="string">&quot;function&quot;</span>)&#123;</span><br><span class="line">            <span class="comment">//开发人员自定义的策略</span></span><br><span class="line">            formObj = <span class="keyword">new</span> type(<span class="built_in">this</span>.$Container,<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span>(type)==<span class="string">&quot;string&quot;</span>)&#123;</span><br><span class="line">            <span class="comment">//首字母大写转换</span></span><br><span class="line">            type    =  type.substring(<span class="number">0</span>,<span class="number">1</span>).toUpperCase() + type.substring(<span class="number">1</span>,type.length);</span><br><span class="line">            <span class="comment">//动态选择已有策略</span></span><br><span class="line">            formObj = <span class="keyword">new</span> Forms[type](<span class="built_in">this</span>.$Container,<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> formObj;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*******************************策略定义*****************************/</span></span><br><span class="line">    <span class="keyword">var</span> Forms = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 默认 只读</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="variable">$container</span></span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="variable">value</span></span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@constructor</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Forms.Span = <span class="function"><span class="keyword">function</span>(<span class="params">$container,value</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.parent = $container;</span><br><span class="line">        <span class="built_in">this</span>._value = value;</span><br><span class="line">        <span class="built_in">this</span>.$Dom   = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="built_in">this</span>._init();</span><br><span class="line">    &#125;;</span><br><span class="line">    Forms.Span.prototype._init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.$Dom   = $(<span class="string">&#x27;&lt;span&gt;&lt;/span&gt;&#x27;</span>).append(<span class="built_in">this</span>._value);</span><br><span class="line">        <span class="built_in">this</span>.parent.append(<span class="built_in">this</span>.$Dom);</span><br><span class="line">    &#125;;</span><br><span class="line">    Forms.Span.prototype.setValue = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.$Dom.html(value);</span><br><span class="line">    &#125;;</span><br><span class="line">    Forms.Span.prototype.getValue = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>._value;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文本框</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="variable">$container</span></span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="variable">value</span></span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@constructor</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Forms.Text = <span class="function"><span class="keyword">function</span>(<span class="params">$container,value</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.parent     = $container;</span><br><span class="line">        <span class="built_in">this</span>._value     = value;</span><br><span class="line">        <span class="built_in">this</span>.$Dom       = <span class="literal">null</span>;</span><br><span class="line">        <span class="built_in">this</span>._init();</span><br><span class="line">    &#125;;</span><br><span class="line">    Forms.Text.prototype._init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.$Dom   = $(<span class="string">&#x27;&lt;input type=&quot;text&quot; style=&quot;width:100%&quot;&gt;&#x27;</span>);</span><br><span class="line">        <span class="built_in">this</span>.parent.append(<span class="built_in">this</span>.$Dom);</span><br><span class="line">        <span class="built_in">this</span>.setValue(<span class="built_in">this</span>._value);</span><br><span class="line">    &#125;;</span><br><span class="line">    Forms.Text.prototype.setValue = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.$Dom.val(value);</span><br><span class="line">    &#125;;</span><br><span class="line">    Forms.Text.prototype.getValue = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.$Dom.val();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">/*自定义对象只需要同样实现set和get方法即可*/</span></span><br><span class="line"></span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用策略模式动态渲染表格行中的单元格</span></span><br><span class="line"><span class="keyword">var</span> grid = Grid.getInstance();</span><br><span class="line">grid.setConfig(&#123;</span><br><span class="line">    placeAt:<span class="string">&quot;GridContainer&quot;</span>,</span><br><span class="line">    layout:[</span><br><span class="line">        &#123;<span class="attr">name</span>:<span class="string">&quot;姓名&quot;</span>,<span class="attr">field</span>:<span class="string">&quot;Name&quot;</span>,<span class="attr">sort</span>:<span class="literal">true</span>,<span class="attr">locked</span>:<span class="literal">true</span>,<span class="attr">editor</span>:&#123;<span class="attr">type</span>:<span class="string">&quot;Text&quot;</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>:<span class="string">&quot;性别&quot;</span>,<span class="attr">field</span>:<span class="string">&quot;Sex&quot;</span>,<span class="attr">sort</span>:<span class="literal">true</span>,<span class="attr">editor</span>:&#123;<span class="attr">type</span>:<span class="string">&quot;radio&quot;</span>,<span class="attr">options</span>:[&#123;<span class="attr">name</span>:<span class="string">&quot;男&quot;</span>,<span class="attr">value</span>:<span class="string">&quot;1&quot;</span>&#125;,&#123;<span class="attr">name</span>:<span class="string">&quot;女&quot;</span>,<span class="attr">value</span>:<span class="string">&quot;0&quot;</span>&#125;]&#125;&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>:<span class="string">&quot;电话&quot;</span>,<span class="attr">field</span>:<span class="string">&quot;Phone&quot;</span>,<span class="attr">editor</span>:&#123;<span class="attr">type</span>:<span class="string">&quot;Text&quot;</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>:<span class="string">&quot;邮件&quot;</span>,<span class="attr">field</span>:<span class="string">&quot;Email&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>:<span class="string">&quot;地址&quot;</span>,<span class="attr">field</span>:<span class="string">&quot;Address&quot;</span>,<span class="attr">format</span>:<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;&#125;&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br><span class="line">grid.addRow();</span><br></pre></td></tr></table></figure>

<p>上一篇：<a href="http://muchstudy.com/2016/11/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%B8%80%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/">设计模式系列之一单例模式</a><br>下一篇：<a href="http://muchstudy.com/2016/11/29/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%B8%89%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/">设计模式系列之三观察者模式</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://muchstudy.com/2016/11/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%BA%8C%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/" data-id="cm5tqeeu8002owayp8o7ffkp2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-设计模式系列之一单例模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%B8%80%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time datetime="2016-11-27T08:16:14.000Z" itemprop="datePublished">2016-11-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%B8%80%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/">设计模式系列之一单例模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Java实现"><a href="#Java实现" class="headerlink" title="Java实现"></a>Java实现</h2><h3 id="不考虑线程安全的写法"><a href="#不考虑线程安全的写法" class="headerlink" title="不考虑线程安全的写法"></a>不考虑线程安全的写法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Singleton uniqueInstance;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (uniqueInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">			uniqueInstance = <span class="keyword">new</span> Singleton();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> uniqueInstance;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// other useful methods here</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;I&#x27;m a classic Singleton!&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这种写法的问题在于非线程安全，当两个线程同时进入if判断，且新对象还未创建时，就会产生两个不同的对象。可以通过<code>synchronized</code>来解决此问题</p>
</blockquote>
<h3 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Singleton uniqueInstance;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// other useful instance variables here</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (uniqueInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">			uniqueInstance = <span class="keyword">new</span> Singleton();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> uniqueInstance;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// other useful methods here</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;I&#x27;m a thread safe Singleton!&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此种写法解决了线程安全问题，但是，由于多线程状态时，需要排队获取单例对象，所以存在性能问题。</p>
</blockquote>
<h3 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Singleton uniqueInstance = <span class="keyword">new</span> Singleton();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> uniqueInstance;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// other useful methods here</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;I&#x27;m a statically initialized Singleton!&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此种方式线程安全且不会出现多线程状态下的性能问题。但是，问题在于即使代码中不会用到该对象，在jvm中也会创建一个，还是不够完美。</p>
</blockquote>
<h3 id="方式三"><a href="#方式三" class="headerlink" title="方式三"></a>方式三</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Danger!  This implementation of Singleton not</span></span><br><span class="line"><span class="comment">// guaranteed to work prior to Java 5</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton uniqueInstance;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (uniqueInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">				<span class="keyword">if</span> (uniqueInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">					uniqueInstance = <span class="keyword">new</span> Singleton();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> uniqueInstance;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此种方式完美解决了多线程问题且能根据需要动态创建单例对象。唯一缺点为<code>volatile</code>关键字在jdk1.5以上才支持。</p>
</blockquote>
<p>两篇介绍<code>volatile</code>关键字的资料：</p>
<ol>
<li><a target="_blank" rel="noopener" href="http://www.infoq.com/cn/articles/ftf-java-volatile">http://www.infoq.com/cn/articles/ftf-java-volatile</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ibm.com/developerworks/cn/java/j-jtp06197.html">http://www.ibm.com/developerworks/cn/java/j-jtp06197.html</a></li>
</ol>
<h2 id="JavaScript实现"><a href="#JavaScript实现" class="headerlink" title="JavaScript实现"></a>JavaScript实现</h2><h3 id="方式一-1"><a href="#方式一-1" class="headerlink" title="方式一"></a>方式一</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">User</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = <span class="string">&quot;YiYing&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user = <span class="keyword">new</span> User();</span><br><span class="line">    <span class="built_in">this</span>.getInstance = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> user = Singleton.getInstance();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此种方式跟上面Java实现的<code>方式二</code>很像，不管用不用，一上来直接创建一个对象，如果代码中不使用就会使得创建的对象冗余。</p>
</blockquote>
<h3 id="方式二-1"><a href="#方式二-1" class="headerlink" title="方式二"></a>方式二</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user = <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">this</span>.getInstance = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(user === <span class="literal">null</span>)&#123;</span><br><span class="line">            user = <span class="keyword">new</span> User();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此种方式实现了动态创建单例对象，相对与上一种更优。</p>
</blockquote>
<h3 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h3><p>假如一个表单上只能允许一个表格存在，现在需要提供一个表格组件给开发人员使用。此时，不希望开发人员创建多个表格对象，可以考虑这样实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//表格组件实现部分</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">W</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> singleton  = <span class="literal">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Grid</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.pagination = <span class="literal">true</span>;</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> init = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line">    Grid.prototype.addRow = <span class="function"><span class="keyword">function</span> (<span class="params">row</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line">    Grid.prototype.deleteRow = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    W.Grid.getInstance = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(singleton===<span class="literal">null</span>)&#123;</span><br><span class="line">            singleton = <span class="keyword">new</span> Grid();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br><span class="line"><span class="comment">//使用部分</span></span><br><span class="line"><span class="keyword">var</span> grid = Grid.getInstance();</span><br><span class="line">grid.addRow();</span><br></pre></td></tr></table></figure>

<p>下一篇：<a href="http://muchstudy.com/2016/11/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%BA%8C%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/">设计模式系列之二策略模式</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://muchstudy.com/2016/11/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E4%B9%8B%E4%B8%80%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" data-id="cm5tqeeu7002kwayp21do53cs" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Gulp实践" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/25/Gulp%E5%AE%9E%E8%B7%B5/" class="article-date">
  <time datetime="2016-11-25T15:25:49.000Z" itemprop="datePublished">2016-11-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/FrontEnd/">FrontEnd</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/25/Gulp%E5%AE%9E%E8%B7%B5/">Gulp实践</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h3 id="NodeJS安装"><a href="#NodeJS安装" class="headerlink" title="NodeJS安装"></a>NodeJS安装</h3><p>在官方网址下载下载安装包即可：<a target="_blank" rel="noopener" href="https://nodejs.org./">https://nodejs.org。</a><br>windows环境下只需要step by step，完成后在CMD中输入<code>node -v</code> 查看是否安装成功</p>
<h3 id="npm安装"><a href="#npm安装" class="headerlink" title="npm安装"></a>npm安装</h3><p><a target="_blank" rel="noopener" href="https://github.com/nodejs-tw/nodejs-wiki-book/blob/master/zh-tw/node_npm.rst">https://github.com/nodejs-tw/nodejs-wiki-book/blob/master/zh-tw/node_npm.rst</a></p>
<h3 id="Gulp安装"><a href="#Gulp安装" class="headerlink" title="Gulp安装"></a>Gulp安装</h3><p>入门指南：<a target="_blank" rel="noopener" href="http://www.gulpjs.com.cn/docs/getting-started/">http://www.gulpjs.com.cn/docs/getting-started/</a></p>
<h2 id="使用Gulp构建项目"><a href="#使用Gulp构建项目" class="headerlink" title="使用Gulp构建项目"></a>使用Gulp构建项目</h2><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>在目前的项目中使用Gulp来对前端资源进行构建，在过程当中牵涉到如下几点：</p>
<ul>
<li>文件删除</li>
<li>RequireJS文件合并。<a target="_blank" rel="noopener" href="https://github.com/requirejs/r.js/blob/master/build/example.build.js">API</a>，需要过一遍原文，因为很多中文翻译内容翻译得不完全</li>
<li>文件MD5</li>
<li>LESS文件编译</li>
<li>文件内容中的字符替换。去掉requirejs中config.js里的<code>.js</code>后缀</li>
<li>文件压缩</li>
<li>文件重命名</li>
<li>Gulp任务顺序处理，解决task异步执行问题</li>
</ul>
<h3 id="代码样例"><a href="#代码样例" class="headerlink" title="代码样例"></a>代码样例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp            = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> rename          = <span class="built_in">require</span>(<span class="string">&quot;gulp-rename&quot;</span>);               <span class="comment">//- 文件重命名</span></span><br><span class="line"><span class="keyword">var</span> concat          = <span class="built_in">require</span>(<span class="string">&#x27;gulp-concat&#x27;</span>);               <span class="comment">//- 多个文件合并为一个</span></span><br><span class="line"><span class="keyword">var</span> rev             = <span class="built_in">require</span>(<span class="string">&#x27;gulp-rev&#x27;</span>);                  <span class="comment">//- 对文件名加MD5后缀</span></span><br><span class="line"><span class="keyword">var</span> revCollector    = <span class="built_in">require</span>(<span class="string">&#x27;gulp-rev-collector&#x27;</span>);        <span class="comment">//- 路径替换</span></span><br><span class="line"><span class="keyword">var</span> reqOptimize     = <span class="built_in">require</span>(<span class="string">&#x27;gulp-requirejs-optimize&#x27;</span>);   <span class="comment">//- requireJs文件合并</span></span><br><span class="line"><span class="keyword">var</span> through2        = <span class="built_in">require</span>(<span class="string">&#x27;through2&#x27;</span>);                  <span class="comment">//- 文件内容操作</span></span><br><span class="line"><span class="keyword">var</span> clean           = <span class="built_in">require</span>(<span class="string">&#x27;gulp-clean&#x27;</span>);                <span class="comment">//- 删除文件</span></span><br><span class="line"><span class="keyword">var</span> runSequence     = <span class="built_in">require</span>(<span class="string">&#x27;run-sequence&#x27;</span>);              <span class="comment">//- 同步执行任务</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> less            = <span class="built_in">require</span>(<span class="string">&#x27;gulp-less&#x27;</span>);                 <span class="comment">//- less文件编译</span></span><br><span class="line"><span class="keyword">var</span> minifycss       = <span class="built_in">require</span>(<span class="string">&#x27;gulp-minify-css&#x27;</span>);           <span class="comment">//- css文件压缩</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">modify</span>(<span class="params">modifier</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> through2.obj(<span class="function"><span class="keyword">function</span>(<span class="params">file, encoding, done</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> content = modifier(<span class="built_in">String</span>(file.contents));</span><br><span class="line">        file.contents = <span class="keyword">new</span> Buffer(content);</span><br><span class="line">        <span class="built_in">this</span>.push(file);</span><br><span class="line">        done();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceSuffix</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> data.replace(<span class="regexp">/\.js/gmi</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//删除掉上一次构建时创建的资源</span></span><br><span class="line">gulp.task(<span class="string">&quot;clean&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> gulp.src([</span><br><span class="line">       <span class="string">&#x27;rev-manifest.json&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;**/*-build-*.js&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;**/*-build-*.css&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;static/core/page/login/login.jsp&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;static/core/page/home/home.jsp&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;static/core/page/home/subHome.jsp&#x27;</span></span><br><span class="line">    ]).pipe(clean());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页框架相关资源构建</span></span><br><span class="line"><span class="comment"> * 合并了如下资源</span></span><br><span class="line"><span class="comment"> * - home-build.js</span></span><br><span class="line"><span class="comment"> * - PDCoreDir/corePath</span></span><br><span class="line"><span class="comment"> * - PDGlobalDir/base</span></span><br><span class="line"><span class="comment"> * - PDHomeDir/js/homeApp</span></span><br><span class="line"><span class="comment"> *   - PDUtilDir/tabs</span></span><br><span class="line"><span class="comment"> *   - PDCoreDir/directive</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">gulp.task(<span class="string">&quot;home-build&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    gulp.src(<span class="string">&quot;static/core/page/home/js/home-build.js&quot;</span>)</span><br><span class="line">        .pipe(reqOptimize(&#123;</span><br><span class="line">            <span class="comment">//optimize:&quot;none&quot;,                              //- none为不压缩资源</span></span><br><span class="line">            <span class="comment">//findNestedDependencies: true,                 //- 解析嵌套中的require</span></span><br><span class="line">            paths:&#123;</span><br><span class="line">                <span class="string">&quot;PDCoreDir&quot;</span>:<span class="string">&quot;../../../&quot;</span>,                    <span class="comment">//- 相对于home-build.js往上3级</span></span><br><span class="line">                <span class="string">&quot;PDGlobalDir&quot;</span>:<span class="string">&quot;../../../../global&quot;</span>,</span><br><span class="line">                <span class="string">&quot;PDHomeDir&quot;</span>:<span class="string">&quot;../&quot;</span>,</span><br><span class="line">                <span class="string">&quot;PDUtilDir&quot;</span>:<span class="string">&quot;../../../../modules/util&quot;</span>,</span><br><span class="line">                <span class="comment">//&quot;PDUtilDir/dialog&quot;:&quot;empty:&quot;,</span></span><br><span class="line">                <span class="string">&quot;Ace-build&quot;</span>:<span class="string">&quot;empty:&quot;</span>,                       <span class="comment">//- 指明需忽略的文件</span></span><br><span class="line">                <span class="comment">//&quot;jqValidate-build&quot;:&quot;empty:&quot;,</span></span><br><span class="line">                <span class="comment">/*&quot;JQuery.validate&quot;:&quot;empty:&quot;,</span></span><br><span class="line"><span class="comment">                &quot;JQuery.validate.message&quot;:&quot;empty:&quot;,</span></span><br><span class="line"><span class="comment">                &quot;JQuery.validate.extra&quot;:&quot;empty:&quot;,*/</span></span><br><span class="line">                <span class="string">&quot;Angular&quot;</span>:<span class="string">&quot;empty:&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Angular-ui-router&quot;</span>:<span class="string">&quot;empty:&quot;</span>,</span><br><span class="line">                <span class="string">&quot;PDAppDir/appPath&quot;</span>:<span class="string">&quot;empty:&quot;</span>,</span><br><span class="line">                <span class="string">&quot;PDAppDir/directive&quot;</span>:<span class="string">&quot;empty:&quot;</span>,</span><br><span class="line">                <span class="string">&quot;PDUtilDir/util&quot;</span>:<span class="string">&quot;empty:&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Bootstrap&quot;</span>:<span class="string">&quot;empty:&quot;</span>,</span><br><span class="line">                <span class="string">&quot;jquery&quot;</span>:<span class="string">&quot;empty:&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;))</span><br><span class="line">        .pipe(rev())                                        <span class="comment">//- 文件名加MD5后缀</span></span><br><span class="line">        .pipe(gulp.dest(<span class="string">&quot;static/core/page/home/js&quot;</span>))        <span class="comment">//- 生成MD5后的文件</span></span><br><span class="line">        .pipe(rev.manifest(&#123;<span class="attr">merge</span>:<span class="literal">true</span>&#125;))                   <span class="comment">//- 生成一个rev-manifest.json</span></span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;&#x27;</span>))                                <span class="comment">//- 映射文件输出目录</span></span><br><span class="line">        .on(<span class="string">&#x27;end&#x27;</span>, cb);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页框架相关资源构建</span></span><br><span class="line"><span class="comment"> * 合并了如下资源</span></span><br><span class="line"><span class="comment"> * - subHome-build.js</span></span><br><span class="line"><span class="comment"> * - PDCoreDir/corePath</span></span><br><span class="line"><span class="comment"> * - PDGlobalDir/base</span></span><br><span class="line"><span class="comment"> * - PDHomeDir/js/subHomeApp</span></span><br><span class="line"><span class="comment"> *   - PDCoreDir/directive</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">gulp.task(<span class="string">&quot;subHome-build&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    gulp.src(<span class="string">&quot;static/core/page/home/js/subHome-build.js&quot;</span>)</span><br><span class="line">        .pipe(reqOptimize(&#123;</span><br><span class="line">            <span class="comment">//optimize:&quot;none&quot;,</span></span><br><span class="line">            <span class="comment">//findNestedDependencies: true,                 //- 解析嵌套中的require</span></span><br><span class="line">            paths:&#123;</span><br><span class="line">                <span class="string">&quot;PDCoreDir&quot;</span>:<span class="string">&quot;../../../&quot;</span>,                  <span class="comment">//相对于home-build.js往上3级</span></span><br><span class="line">                <span class="string">&quot;PDGlobalDir&quot;</span>:<span class="string">&quot;../../../../global&quot;</span>,</span><br><span class="line">                <span class="string">&quot;PDHomeDir&quot;</span>:<span class="string">&quot;../&quot;</span>,</span><br><span class="line">                <span class="string">&quot;PDUtilDir&quot;</span>:<span class="string">&quot;../../../../modules/util&quot;</span>,</span><br><span class="line">                <span class="string">&quot;jqValidate-build&quot;</span>:<span class="string">&quot;empty:&quot;</span>,</span><br><span class="line">                <span class="comment">/*&quot;JQuery.validate&quot;:&quot;empty:&quot;,</span></span><br><span class="line"><span class="comment">                 &quot;JQuery.validate.message&quot;:&quot;empty:&quot;,</span></span><br><span class="line"><span class="comment">                 &quot;JQuery.validate.extra&quot;:&quot;empty:&quot;,*/</span></span><br><span class="line">                <span class="string">&quot;Angular&quot;</span>:<span class="string">&quot;empty:&quot;</span>,</span><br><span class="line">                <span class="string">&quot;PDAppDir/appPath&quot;</span>:<span class="string">&quot;empty:&quot;</span>,</span><br><span class="line">                <span class="string">&quot;PDAppDir/directive&quot;</span>:<span class="string">&quot;empty:&quot;</span>,</span><br><span class="line">                <span class="string">&quot;PDUtilDir/util&quot;</span>:<span class="string">&quot;empty:&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Bootstrap&quot;</span>:<span class="string">&quot;empty:&quot;</span>,</span><br><span class="line">                <span class="string">&quot;jquery&quot;</span>:<span class="string">&quot;empty:&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;))</span><br><span class="line">        .pipe(rev())                                        <span class="comment">//- 文件名加MD5后缀</span></span><br><span class="line">        .pipe(gulp.dest(<span class="string">&quot;static/core/page/home/js&quot;</span>))        <span class="comment">//- 生成MD5后的文件</span></span><br><span class="line">        .pipe(rev.manifest(&#123;<span class="attr">merge</span>:<span class="literal">true</span>&#125;))                   <span class="comment">//- 生成一个rev-manifest.json</span></span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;&#x27;</span>))                                <span class="comment">//- 映射文件输出目录</span></span><br><span class="line">        .on(<span class="string">&#x27;end&#x27;</span>, cb);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ACE文件合并</span></span><br><span class="line">gulp.task(<span class="string">&quot;ace-build&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    gulp.src(<span class="string">&quot;static/modules/ace/dist/js/ace-build.js&quot;</span>)</span><br><span class="line">        .pipe(reqOptimize(&#123;</span><br><span class="line">            <span class="comment">//optimize:&quot;none&quot;,</span></span><br><span class="line">            <span class="comment">//mainConfigFile: &#x27;static/global/config-build.js&#x27;,</span></span><br><span class="line">            paths:&#123;</span><br><span class="line">                <span class="string">&quot;Ace&quot;</span>:<span class="string">&quot;ace.min&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Ace-extra&quot;</span>:<span class="string">&quot;ace-extra.min&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Ace-element&quot;</span>:<span class="string">&quot;ace-elements.min&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Bootstrap&quot;</span>:<span class="string">&quot;empty:&quot;</span>,</span><br><span class="line">                <span class="string">&quot;jquery&quot;</span>:<span class="string">&quot;empty:&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            shim:&#123;</span><br><span class="line">                <span class="string">&quot;Ace&quot;</span>:[<span class="string">&quot;Bootstrap&quot;</span>, <span class="string">&quot;jquery&quot;</span>],</span><br><span class="line">                <span class="string">&quot;Ace-element&quot;</span>:[<span class="string">&quot;Ace&quot;</span>],</span><br><span class="line">                <span class="string">&quot;Ace-extra&quot;</span>:[<span class="string">&quot;Ace&quot;</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;))</span><br><span class="line">        .pipe(rev())</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;static/modules/ace/dist/js/&#x27;</span>))</span><br><span class="line">        .pipe(rev.manifest(&#123;<span class="attr">merge</span>:<span class="literal">true</span>&#125;))</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">        .on(<span class="string">&#x27;end&#x27;</span>, cb);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jquery.validate.min.js、messages_zh.js、additional-methods.js合并为一个文件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">gulp.task(<span class="string">&quot;jqValidate-build&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dir = <span class="string">&quot;static/modules/jquery/plugins/validate&quot;</span>;</span><br><span class="line">    gulp.src(dir+<span class="string">&quot;/jqValidate-build.js&quot;</span>)</span><br><span class="line">        .pipe(reqOptimize(&#123;</span><br><span class="line">            <span class="comment">//optimize:&quot;none&quot;,</span></span><br><span class="line">            <span class="comment">//findNestedDependencies: true,</span></span><br><span class="line">            paths:&#123;</span><br><span class="line">                <span class="string">&quot;JQuery.validate&quot;</span>:<span class="string">&quot;jquery.validate.min&quot;</span>,</span><br><span class="line">                <span class="string">&quot;JQuery.validate.message&quot;</span>:<span class="string">&quot;localization/messages_zh&quot;</span>,</span><br><span class="line">                <span class="string">&quot;JQuery.validate.extra&quot;</span>:<span class="string">&quot;additional-methods&quot;</span>,</span><br><span class="line">                <span class="string">&quot;jquery&quot;</span>:<span class="string">&quot;empty:&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            wrapShim:<span class="literal">true</span>,</span><br><span class="line">            shim:&#123;</span><br><span class="line">                <span class="string">&quot;JQuery.validate.message&quot;</span>:[<span class="string">&quot;JQuery.validate&quot;</span>],</span><br><span class="line">                <span class="string">&quot;JQuery.validate.extra&quot;</span>:[<span class="string">&quot;JQuery.validate&quot;</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;))</span><br><span class="line">        .pipe(rev())</span><br><span class="line">        .pipe(gulp.dest(dir))</span><br><span class="line">        .pipe(rev.manifest(&#123;<span class="attr">merge</span>:<span class="literal">true</span>&#125;))</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">        .on(<span class="string">&#x27;end&#x27;</span>, cb);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//util目录下util.js文件合并压缩</span></span><br><span class="line">gulp.task(<span class="string">&quot;util-build&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    gulp.src([<span class="string">&#x27;static/modules/util/util-build.js&#x27;</span>])</span><br><span class="line">        .pipe(reqOptimize(&#123;</span><br><span class="line">            <span class="comment">//optimize:&quot;none&quot;,</span></span><br><span class="line">            <span class="comment">//findNestedDependencies: true,                 //- 解析嵌套中的require</span></span><br><span class="line">            paths:&#123;</span><br><span class="line">                <span class="string">&quot;PDUtilDir&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="comment">//&quot;PDUtilDir/dialog&quot;:&quot;empty:&quot;,</span></span><br><span class="line">                <span class="comment">//&quot;Bootstrap&quot;:&quot;empty:&quot;,</span></span><br><span class="line">                <span class="string">&quot;jquery&quot;</span>:<span class="string">&quot;empty:&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;))</span><br><span class="line">        .pipe(rev())                                        <span class="comment">//- 文件名加MD5后缀</span></span><br><span class="line">        .pipe(gulp.dest(<span class="string">&quot;static/modules/util&quot;</span>))</span><br><span class="line">        <span class="comment">//.pipe(rename(&#123;extname: &quot;&quot;&#125;))                      //- 映射文件中去掉后缀</span></span><br><span class="line">        .pipe(rev.manifest(&#123;<span class="attr">merge</span>:<span class="literal">true</span>&#125;))                   <span class="comment">//- 生成一个rev-manifest.json</span></span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;&#x27;</span>))                                <span class="comment">//- 映射文件输出目录</span></span><br><span class="line">        .on(<span class="string">&#x27;end&#x27;</span>, cb);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//config文件中路径替换</span></span><br><span class="line">gulp.task(<span class="string">&quot;replaceConfigPathTemp&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    gulp.src([<span class="string">&#x27;rev-manifest.json&#x27;</span>, <span class="string">&#x27;static/global/config-build.js&#x27;</span>])</span><br><span class="line">        .pipe(revCollector())</span><br><span class="line">        .pipe(rev())</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;static/global&#x27;</span>))</span><br><span class="line">        .pipe(rev.manifest(&#123;<span class="attr">merge</span>:<span class="literal">true</span>&#125;))</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">        .on(<span class="string">&#x27;end&#x27;</span>, cb);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//替换掉config-build-md5.js文件中的所有js文件后缀</span></span><br><span class="line">gulp.task(<span class="string">&quot;replaceConfigPath&quot;</span>,[<span class="string">&quot;replaceConfigPathTemp&quot;</span>],<span class="function"><span class="keyword">function</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    gulp.src([<span class="string">&#x27;static/global/config-build-*.js&#x27;</span>])</span><br><span class="line">        .pipe(modify(replaceSuffix))            <span class="comment">//- 去掉.js后缀</span></span><br><span class="line">        .pipe(gulp.dest(<span class="string">&quot;static/global&quot;</span>))</span><br><span class="line">        <span class="comment">//.pipe(rename(&quot;config.js&quot;))              //- 生成一份不带MD5的config文件</span></span><br><span class="line">        <span class="comment">//.pipe(gulp.dest(&quot;static/global&quot;))</span></span><br><span class="line">        .on(<span class="string">&#x27;end&#x27;</span>, cb);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * - 首页路径替换</span></span><br><span class="line"><span class="comment"> * - 替换config-build.js、home-build.js</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">gulp.task(<span class="string">&quot;replaceHomePath&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    gulp.src([<span class="string">&#x27;rev-manifest.json&#x27;</span>, <span class="string">&#x27;static/core/page/home/home-build.jsp&#x27;</span>])</span><br><span class="line">        .pipe(revCollector())</span><br><span class="line">        .pipe(rename(<span class="string">&quot;home.jsp&quot;</span>))</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;static/core/page/home&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * - SubHome中的路径替换</span></span><br><span class="line"><span class="comment"> * - 替换config-build.js、subHome-build.js</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">gulp.task(<span class="string">&quot;replaceSubHomePath&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    gulp.src([<span class="string">&#x27;rev-manifest.json&#x27;</span>, <span class="string">&#x27;static/core/page/home/subHome-build.jsp&#x27;</span>])</span><br><span class="line">        .pipe(revCollector())</span><br><span class="line">        .pipe(rename(<span class="string">&quot;subHome.jsp&quot;</span>))</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;static/core/page/home&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">&quot;replaceLoginFormPath&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    gulp.src([<span class="string">&#x27;rev-manifest.json&#x27;</span>, <span class="string">&#x27;static/core/page/login/login-build.jsp&#x27;</span>])</span><br><span class="line">        .pipe(revCollector())</span><br><span class="line">        .pipe(rename(<span class="string">&quot;login.jsp&quot;</span>))</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;static/core/page/login&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//构建总入口</span></span><br><span class="line">gulp.task(<span class="string">&#x27;default&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    runSequence(</span><br><span class="line">        <span class="string">&quot;clean&quot;</span>,                <span class="comment">//- 上一次构建的结果清空</span></span><br><span class="line">        <span class="string">&quot;home-build&quot;</span>,           <span class="comment">//- 首页相关资源合并</span></span><br><span class="line">        <span class="string">&quot;subHome-build&quot;</span>,        <span class="comment">//- SubHome相关</span></span><br><span class="line">        <span class="string">&quot;ace-build&quot;</span>,            <span class="comment">//- ace相关资源合并</span></span><br><span class="line">        <span class="string">&quot;jqValidate-build&quot;</span>,     <span class="comment">//- 语言包与验证插件合并为一个</span></span><br><span class="line">        <span class="string">&quot;util-build&quot;</span>,           <span class="comment">//- 把loading、slidebar合并到util中</span></span><br><span class="line">        <span class="string">&quot;replaceConfigPath&quot;</span>,    <span class="comment">//- config.js中路径处理</span></span><br><span class="line">        <span class="comment">//- 需先编译css再替换相关页面路径</span></span><br><span class="line">        <span class="string">&quot;component-less&quot;</span>,</span><br><span class="line">        <span class="string">&quot;home-less&quot;</span>,</span><br><span class="line">        <span class="string">&quot;login-less&quot;</span>,</span><br><span class="line">        <span class="comment">//- 可并行处理</span></span><br><span class="line">        [<span class="string">&quot;replaceHomePath&quot;</span>,<span class="string">&quot;replaceSubHomePath&quot;</span>,<span class="string">&quot;replaceLoginFormPath&quot;</span>],</span><br><span class="line">        callback);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//文件内容变更动态构建</span></span><br><span class="line">gulp.task(<span class="string">&quot;start&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    gulp.watch(<span class="string">&quot;static/**&quot;</span>,[<span class="string">&quot;default&quot;</span>])</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/***********************LESS文件编译***********************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * - 登录页面相关</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">gulp.task(<span class="string">&quot;login-less&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dir = <span class="string">&quot;static/core/page/login/theme&quot;</span>;</span><br><span class="line">    gulp.src(dir+<span class="string">&quot;/login-build.less&quot;</span>)</span><br><span class="line">        .pipe(less())</span><br><span class="line">        .pipe(minifycss())</span><br><span class="line">        .pipe(rev())</span><br><span class="line">        .pipe(gulp.dest(dir))</span><br><span class="line">        .pipe(rev.manifest(&#123;<span class="attr">merge</span>:<span class="literal">true</span>&#125;))</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">        .on(<span class="string">&#x27;end&#x27;</span>, cb);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * - util下的所有产品组件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">gulp.task(<span class="string">&quot;component-less&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dir = <span class="string">&quot;static/modules/util/css&quot;</span>;</span><br><span class="line">    gulp.src(dir+<span class="string">&quot;/components-build.less&quot;</span>)</span><br><span class="line">        .pipe(less())</span><br><span class="line">        .pipe(minifycss())</span><br><span class="line">        .pipe(rev())</span><br><span class="line">        .pipe(gulp.dest(dir))</span><br><span class="line">        .pipe(rev.manifest(&#123;<span class="attr">merge</span>:<span class="literal">true</span>&#125;))</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">        .on(<span class="string">&#x27;end&#x27;</span>, cb);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * - 首页相关</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">gulp.task(<span class="string">&quot;home-less&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dir = <span class="string">&quot;static/core/page/home/css&quot;</span>;</span><br><span class="line">    gulp.src(dir+<span class="string">&quot;/home-build.less&quot;</span>)</span><br><span class="line">        .pipe(less())</span><br><span class="line">        .pipe(minifycss())</span><br><span class="line">        .pipe(rev())</span><br><span class="line">        .pipe(gulp.dest(dir))</span><br><span class="line">        .pipe(rev.manifest(&#123;<span class="attr">merge</span>:<span class="literal">true</span>&#125;))</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">        .on(<span class="string">&#x27;end&#x27;</span>, cb);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://muchstudy.com/2016/11/25/Gulp%E5%AE%9E%E8%B7%B5/" data-id="cm5tqeeu6002hwayp5ev03kae" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-登录模块的设计" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/20/%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97%E7%9A%84%E8%AE%BE%E8%AE%A1/" class="article-date">
  <time datetime="2016-11-20T11:09:27.000Z" itemprop="datePublished">2016-11-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programmer/">Programmer</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/20/%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97%E7%9A%84%E8%AE%BE%E8%AE%A1/">登录模块的设计</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <img src="/2016/11/20/%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97%E7%9A%84%E8%AE%BE%E8%AE%A1/%E7%99%BB%E5%BD%95.jpg" class="">

<p>&emsp;&emsp;最近做完系统登录模块的重构，登录这块的核心在于安全的控制。下面通过本文来总结一下登录模块的设计实现，以及哪些方面需要注意。</p>
<h2 id="用户创建"><a href="#用户创建" class="headerlink" title="用户创建"></a>用户创建</h2><ul>
<li>密码保存需要做不可逆加密。即密码不能明文保存且即使是内部技术人员也无法得到真实密码，常见的加密方法有MD5，SHA系列算法，如果对加密算法不太了解的可以移步<a href="http://muchstudy.com/2016/09/04/%E5%AE%89%E5%85%A8%E7%AE%97%E6%B3%95%E6%A2%B3%E7%90%86/">这里</a>。</li>
<li>密码强度限制。不允许使用弱口令，比如跟用户生日相等。</li>
<li>手机、邮箱验证。方便后续找回密码。</li>
</ul>
<h2 id="用户登录"><a href="#用户登录" class="headerlink" title="用户登录"></a>用户登录</h2><h3 id="需要注意的问题"><a href="#需要注意的问题" class="headerlink" title="需要注意的问题"></a>需要注意的问题</h3><ul>
<li>使用验证码。增加暴力破解的成本。</li>
<li>登录错误次数限制，一定时间后自动解锁，彻底堵死暴力破解。</li>
<li>关键cookie设置HTTPOnly属性，防止xss盗取用户cookie。</li>
<li>保证密码在网络传输中的安全。启用HTTPS，或使用RAS加密。请求登录界面时，生成公钥与私钥，私钥放在服务器端，密码传输前，使用公钥加密，服务器端收到密文后使用私钥解密密文得到用户输入的真实密码。</li>
<li>集群状态下，采用session共享的方式实现SSO时，在session上记录的登录状态信息需要可序列化。</li>
<li>页面跳转时使用服务器端跳转，<code>request.getRequestDispatcher().forward()</code>。尽量不要使用<code>response.sendRedirect()</code>,因为每次redirect都会触发客户端304，重新再次发起一次HTTP请求。</li>
</ul>
<h3 id="记住密码"><a href="#记住密码" class="headerlink" title="记住密码"></a>记住密码</h3><p>可以考虑这样去实现记住密码功能：cookie中需要保存如下3个值<br>username：用户的登录名<br>token：使用公钥加密过的用户密码<br>sequence：登录序列（防重放攻击。如果自动登录的该字段与服务器的不相符时，则证明用户在其他地方登录过。）  </p>
<p>&emsp;&emsp;当勾选记住密码登录时，在服务器端保存当前的私钥、生成一个随机的登录序列（UUID）保存起来。同时，把用户名、登录传输过来的已经用公钥加密的密文、新生成的sequence保存到cookie中。下次用户请求登录页面时，从cookie中取得用户名放到用户名的输入框中，任意字符串放到密码框中，继续勾选上记住密码框。这个时候只需要输入验证码即可点击登录按钮。服务器端，判断出本次登录是记住密码登录，首先验证cookie中的sequence是否跟服务保存的一致，如果不一致，则登录失败。一致时，取出私钥解密从cookie中拿到的token，得到真实密码，接着按照常规登录流程完成登录验证。</p>
<h2 id="密码变更"><a href="#密码变更" class="headerlink" title="密码变更"></a>密码变更</h2><ul>
<li>修改密码需要提供原始密码</li>
<li>相关信息在网络传输中需保证加密传输</li>
<li>找回密码功能可以考虑使用手机验证码，邮件链接实现。另外，还可考虑提供用户在本系统中的留痕供用户选择（比如什么时候注册、最近做了什么操作等），从而识别出真正的用户。</li>
</ul>
<h2 id="日志记录"><a href="#日志记录" class="headerlink" title="日志记录"></a>日志记录</h2><ul>
<li>记录用户的登录日志。可记录下登录时间、退出时间、IP等信息，分析过往日志，甄别出异常登录并提醒用户。</li>
<li>记录用户登录失败日志。限制登录失败重试次数，防止暴力破解。</li>
</ul>
<h2 id="服务器相关"><a href="#服务器相关" class="headerlink" title="服务器相关"></a>服务器相关</h2><p>&emsp;&emsp;有时应用的安全部分做得再好，也抵不住服务器直接被攻破，所以运行应用的服务器的安全也需要特别注意。</p>
<ul>
<li>服务器访问日志（建议开启）</li>
<li>可疑用户</li>
<li>可疑进程</li>
<li>可疑服务</li>
<li>操作系统日志（日志最大大小） 定期备份</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://muchstudy.com/2016/11/20/%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97%E7%9A%84%E8%AE%BE%E8%AE%A1/" data-id="cm5tqeeu5002cwaypb02h1l1p" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-每一个优秀的人，都有一段默默努力的时光" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/19/%E6%AF%8F%E4%B8%80%E4%B8%AA%E4%BC%98%E7%A7%80%E7%9A%84%E4%BA%BA%EF%BC%8C%E9%83%BD%E6%9C%89%E4%B8%80%E6%AE%B5%E9%BB%98%E9%BB%98%E5%8A%AA%E5%8A%9B%E7%9A%84%E6%97%B6%E5%85%89/" class="article-date">
  <time datetime="2016-11-19T08:29:13.000Z" itemprop="datePublished">2016-11-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Life/">Life</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/19/%E6%AF%8F%E4%B8%80%E4%B8%AA%E4%BC%98%E7%A7%80%E7%9A%84%E4%BA%BA%EF%BC%8C%E9%83%BD%E6%9C%89%E4%B8%80%E6%AE%B5%E9%BB%98%E9%BB%98%E5%8A%AA%E5%8A%9B%E7%9A%84%E6%97%B6%E5%85%89/">每一个优秀的人，都有一段默默努力的时光</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <img src="/2016/11/19/%E6%AF%8F%E4%B8%80%E4%B8%AA%E4%BC%98%E7%A7%80%E7%9A%84%E4%BA%BA%EF%BC%8C%E9%83%BD%E6%9C%89%E4%B8%80%E6%AE%B5%E9%BB%98%E9%BB%98%E5%8A%AA%E5%8A%9B%E7%9A%84%E6%97%B6%E5%85%89/%E5%8A%AA%E5%8A%9B%E6%97%B6%E5%85%89.jpg" class="" title="努力时光">

<p>&emsp;&emsp;“每一个优秀的人，都有一段默默努力的时光。”，在上班的地铁上，打开百词斩，这句话第一时间映入眼帘。</p>
<p>&emsp;&emsp;还记得高中时，有一哥们儿经常被大家喷，什么原因呢？是这样的，这哥们儿各科成绩很好，另外，大家都知道这哥们儿很勤奋努力，每天晚自习回家都要背一下单词，复习一下第二天要学习的新知识点才睡觉。喜欢运动，一有空就叫人一起去篮球场打球。作业少，较轻松的时候，大家当然都很乐意跟他一起去投投篮什么的。当作业堆成小山的时候，这哥们儿每叫一次就会被喷一次，被喷的核心内容在于他自己的事情干完了就开始勾引其他人了……</p>
<p>&emsp;&emsp;回想起当年高中时的日子，算得上是人生当中的一段努力时光。</p>
<p>&emsp;&emsp;到了大学，高中时肩上那种沉重压力灰飞烟灭。放下担子，一路轻快的飞奔，沉醉在那自由自在的欢快时光中，无法自拔。然而，一个不经意间就到了毕业季……</p>
<p>&emsp;&emsp;刚工作时，什么都不懂，觉得周围的人都是大神，感觉离他们之间有相当遥远的距离，可望而不可及。</p>
<p>&emsp;&emsp;一次出差，到外地培训公司新招的实习生，在当地的讲师队伍中有一位喜欢吹牛逼讲师。他在给还没毕业的学弟学妹的讲课当中，常常吹嘘自己看了多少书，吹嘘自己看过市面上的所有心理学书籍，看过所有的关于超级记忆的书籍。听到“所有”这两字，我就呵呵了，不由得就跟“吹牛”划上了等号。在后来的慢慢接触当中，渐渐发现他思维开阔，懂的东西特别的多，不管什么内容不仅能扩展开了泛泛而谈，而且能深入直达本质。另外，他的确喜欢读书，经常看到他收快递，十有八九都是书。深入了解后，从他的口中了解到，他曾经喜欢研究心理学，所以才把市面上所有经典的心理学书籍都买来看，为了帮助小孩儿学英语，把市面上的所有关于超级记忆的书都买来看了一遍！了解到这些，不由得一阵惊叹！然后不理解的再问了一个问题，“也没必要把所有相关的书都买了吧？”，他给我的答案是：“<strong>在这个世界上，书是最廉价的东西，只要这本书中有一句话影响到你，对你有益。那么，这本书就没有白买，这种益处还是终生的！想想就觉得相当的赚。</strong>”。听到这个回答，再次被惊着，世界观被颠覆。</p>
<p>&emsp;&emsp;在这次出差当中，正巧一位集团的副总裁在这边，顺便叫了过来给新招的实习生做一下分享，顺便让大家见见今后的领导。对于当时也属于新兵的我来说，这位领导如在云端，遥不可及。他从他的读书生涯讲起，讲他的高中时光，讲他的大学时光，讲他是怎么样从高中走进了清华的校园，然后怎么样从清华校园到出国学习，接着工作，然后一直到目前上市公司副总裁的位置。讲完他的人生履历，他总结道，其实，他并不聪明，只是比别人更努力而已。曾经由于期末成绩不好，在暑假发狠重学上学期的所有功课，周末一人泡在自习室，别人在尽情欢乐的时候他却泡在图书馆。<strong>因为没办法，没别人聪明，那就只有靠努力来补</strong>。最后，他希望大家都成为一个努力的人。听完他的分享，觉得他其实跟大家一样，都站在地上，并没有想象的那么遥远。</p>
<p>&emsp;&emsp;在工作的这些年中，不乏一些名牌大学毕业、一些工作很多年头的同事。一些同事的确很聪明，经验很丰富。但另一些同事你会明显感觉到他过去的丰富履历跟目前工作能力不相符。而零星的一些过去履历不怎么闪耀的同事反而工作能力出众，他们的实际能力远远超出了过去平淡履历的客观印象。一个能够解释其中原因的逻辑为，一些人在很久以前即达到了人生的顶峰，然后慢慢的往下走。而另外一些人慢慢从波谷走出来，不断往顶峰攀登。大家上班的时间都是差不多的，在上班时间都需要为公司创造价值，很少有自己的时间。因此，可以肯定，在工作之外，那些不断向前的人应当远远不止一段默默努力的时光。</p>
<p>&emsp;&emsp;曾经在知乎上回答过一个跟逆袭相关的问题，当时我的回答是，<strong>逆袭并不是一个偶然事件，而是一个量变产生质变的事件</strong>。本来就不聪明当然要比聪明的人下更多的功夫。聪明是天生优势，如果停止不前也是很容易被笨蛋超越的。知乎上面，还有一句广泛被大众所知的一句话：“以大多数人的努力程度，远远还没到拼天赋的时候！”</p>
<p>&emsp;&emsp;最后，只想对自己说：“你一直在努力的路上，你的征途是知识的星辰大海。”</p>
<p>作者公众号：<br><img src='http://muchstudy.com/2019/11/10/%E4%B8%80%E6%96%87%E6%90%9E%E5%AE%9AJS%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/YIYING.jpg'></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://muchstudy.com/2016/11/19/%E6%AF%8F%E4%B8%80%E4%B8%AA%E4%BC%98%E7%A7%80%E7%9A%84%E4%BA%BA%EF%BC%8C%E9%83%BD%E6%9C%89%E4%B8%80%E6%AE%B5%E9%BB%98%E9%BB%98%E5%8A%AA%E5%8A%9B%E7%9A%84%E6%97%B6%E5%85%89/" data-id="cm5tqeeu40029wayp8vgc3k2y" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Servlet中Cookie增、删、改、查" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/18/Servlet%E4%B8%ADCookie%E5%A2%9E%E3%80%81%E5%88%A0%E3%80%81%E6%94%B9%E3%80%81%E6%9F%A5/" class="article-date">
  <time datetime="2016-11-18T06:43:04.000Z" itemprop="datePublished">2016-11-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/18/Servlet%E4%B8%ADCookie%E5%A2%9E%E3%80%81%E5%88%A0%E3%80%81%E6%94%B9%E3%80%81%E6%9F%A5/">Servlet中Cookie增、删、改、查</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&emsp;&emsp;整理了一个在Servlet中对Cookie增删改查的工具类，首先要注意的是在服务器端是无法对Cookie做修改的，只能做到覆盖创建。</p>
<p><strong>引用StackOverflow上James Sumners的<a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/5093250/how-do-you-update-an-existing-cookie-in-jsp">回答</a>：</strong></p>
<blockquote>
<p>Per section 3.3.4 of <a target="_blank" rel="noopener" href="http://www.ietf.org/rfc/rfc2965.txt">RFC 2965</a>, the user agent does not include the expiration information in the cookie header that is sent to the server. Therefore, there is no way to update an existing cookie’s value while retaining the expiration date that was initially set based solely on the information associated with the cookie.</p>
</blockquote>
<blockquote>
<p>So the answer to this question is: you can’t do that.</p>
</blockquote>
<p><strong>工具类如下：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.net.URLDecoder;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CookieUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 新增Cookie</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addCookie</span><span class="params">(HttpServletResponse response, String name,String value)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//特殊字符需要编码</span></span><br><span class="line">			Cookie cookie = <span class="keyword">new</span> Cookie(name,URLEncoder.encode(value, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">			cookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span>);	<span class="comment">//- 单位为秒，7天有效</span></span><br><span class="line">			cookie.setPath(<span class="string">&quot;/&quot;</span>);			<span class="comment">//- 根路径</span></span><br><span class="line">			<span class="comment">//JavaEE5兼容</span></span><br><span class="line">			<span class="keyword">try</span>&#123;</span><br><span class="line">				cookie.setHttpOnly(<span class="keyword">true</span>);	<span class="comment">//- 防XSS</span></span><br><span class="line">			&#125;<span class="keyword">catch</span> (NoSuchMethodError e) &#123;</span><br><span class="line">	        	e.printStackTrace();</span><br><span class="line">	        &#125;</span><br><span class="line">			response.addCookie(cookie);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 删除Cookie</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">deleteCookie</span><span class="params">(HttpServletRequest request,HttpServletResponse response, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (request.getCookies() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Cookie cookie : request.getCookies()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (cookie.getName().equals(name)) &#123;</span><br><span class="line">                	cookie.setMaxAge(<span class="number">0</span>);</span><br><span class="line">                	<span class="comment">//经测试发现还需设置如下两个值,之所以这样，原理为覆盖掉Cookie，而不是常规意义中的删除</span></span><br><span class="line">									cookie.setValue(<span class="string">&quot;&quot;</span>);</span><br><span class="line">									cookie.setPath(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">                	response.addCookie(cookie);</span><br><span class="line">									<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 覆盖掉之前的cookie</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">overrideCookie</span><span class="params">(HttpServletRequest request,HttpServletResponse response, String name,String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (request.getCookies() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Cookie cookie : request.getCookies()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (cookie.getName().equals(name)) &#123;</span><br><span class="line">                	cookie.setValue(value);</span><br><span class="line">									cookie.setPath(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">									<span class="comment">//cookie.getMaxAge()为-1，服务器端无法获取MaxAge</span></span><br><span class="line">									cookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span>);</span><br><span class="line">									response.addCookie(cookie);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取Cookie</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Cookie <span class="title">getCookie</span><span class="params">(HttpServletRequest request, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (request.getCookies() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Cookie cookie : request.getCookies()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (cookie.getName().equals(name)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> cookie;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取Cookie对应的值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getCookieValue</span><span class="params">(HttpServletRequest request, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (request.getCookies() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Cookie cookie : request.getCookies()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (cookie.getName().equals(name)) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">						<span class="keyword">return</span> URLDecoder.decode(cookie.getValue(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e.printStackTrace();</span><br><span class="line">						<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">					&#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://muchstudy.com/2016/11/18/Servlet%E4%B8%ADCookie%E5%A2%9E%E3%80%81%E5%88%A0%E3%80%81%E6%94%B9%E3%80%81%E6%9F%A5/" data-id="cm5tqeeu30025wayp3pbdhjg5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7%E7%B1%BB/" rel="tag">工具类</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-关于代码质量的一点思考" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/13/%E5%85%B3%E4%BA%8E%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/" class="article-date">
  <time datetime="2016-11-13T08:20:51.000Z" itemprop="datePublished">2016-11-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programmer/">Programmer</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/13/%E5%85%B3%E4%BA%8E%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/">关于代码质量的一点思考</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&emsp;&emsp;最近在做基础开发框架登录模块的重构，所以来谈一谈关于代码质量的思考。<br>&emsp;&emsp;进入正题之前，先吐槽一下，看看能不能引起一点共鸣。<br>&emsp;&emsp;之所以要重构这部分的代码，原因很简单，公司的测试团队通过压力测试发现登录这块有性能问题。同时，基于另外一个使用产品基础开发框架的团队需要在登录这块进行一些业务上的扩展。怀着激动的心情打开这块的相关代码，首先第一感觉就是杂乱无章，排版糟糕。没办法，要解决问题，还是得硬着头皮看下去。接着，从前端UI界面的输入到提交看起，发现代码相当的绕，很难看懂其中的逻辑。另外，其中还有大片的冗余拖沓代码。虽然整体功能逻辑完整的实现了，但是实现细节一团糟。毫不夸张的说，很多部分的代码完全属于技术验证阶段的代码。遇到这样的代码，我想很少能有人能静下心来完完整整的看完……</p>
<p>下面说说我所认为的代码是怎么样的:  </p>
<ol>
<li>代码需要排版整洁干净、并且有清晰适当的注释，当打开代码源文件的瞬间，能给人一种赏心悦目的感觉。</li>
<li>代码要简洁，不拖沓，不能为了封装而封装，为了面向对象而面向对象。重复功能的代码尽量封装成方法，杜绝成段成段的相同代码、冗余代码。</li>
<li>代码的结构要清晰，让其他人能轻松的找到程序的入口，轻松摸清代码的整体脉络，并且不看每个方法中的具体内容，只需要看整个代码的骨骼即能了解程序的功能。</li>
<li>模块与模块的对接部分要简洁。大部分情况为沟通不彻底或者相互对对方的模块缺乏基本的了解造成。</li>
<li>注重代码的性能。这一块不仅需要从纯技术角度去考虑代码的性能，还需要深入的了解业务需求，往往一个灵光一闪的想法就能节约成片的代码、以简单的逻辑实现复杂的业务需求。</li>
</ol>
<p>一些思考：</p>
<ol>
<li>好的代码往往是经过不断的打磨产生的，一个精进的程序员应当具备一颗喜欢折腾代码的躁动的心。</li>
<li>对于框架级的代码，越早重构越好，越往后拖所带来的成本越大。</li>
<li>糟糕代码质量的代码后期维护成本不可估量，甚至会影响到后续新功能的开发，从这里真正能对比出一个优秀Programmer的价值。</li>
<li>写代码也是一门艺术。一段完美精致代码的创造过程不亚于一件艺术品的创作过程。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://muchstudy.com/2016/11/13/%E5%85%B3%E4%BA%8E%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/" data-id="cm5tqeeu20022wayp9ju87u3w" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/14/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><a class="page-number" href="/page/17/">17</a><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/16/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DBMS/">DBMS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/FrontEnd/">FrontEnd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/">HTTP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Maven/">Maven</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Programmer/">Programmer</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Thinking/">Thinking</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%A7%E5%93%81%E7%A0%94%E5%8F%91/">产品研发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E5%AE%83/">其它</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%85%A8/">安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84/">架构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP%E5%AE%89%E5%85%A8/" rel="tag">HTTP安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP%E7%8A%B6%E6%80%81%E7%A0%81/" rel="tag">HTTP状态码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP%E8%BF%9E%E6%8E%A5/" rel="tag">HTTP连接</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Life/" rel="tag">Life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/POI/" rel="tag">POI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RSA/" rel="tag">RSA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nexus/" rel="tag">nexus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/restfull/" rel="tag">restfull</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlmap/" rel="tag">sqlmap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql%E6%B3%A8%E5%85%A5/" rel="tag">sql注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%93%B2%E5%AD%A6/" rel="tag">哲学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%A2%E9%98%9F%E7%AE%A1%E7%90%86/" rel="tag">团队管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E5%85%A8/" rel="tag">安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E4%BD%9C%E6%80%9D%E8%80%83/" rel="tag">工作思考</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7%E7%B1%BB/" rel="tag">工具类</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" rel="tag">排序算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%93%E5%AD%98/" rel="tag">缓存</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6/" rel="tag">读书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/HTTP%E5%AE%89%E5%85%A8/" style="font-size: 10px;">HTTP安全</a> <a href="/tags/HTTP%E7%8A%B6%E6%80%81%E7%A0%81/" style="font-size: 10px;">HTTP状态码</a> <a href="/tags/HTTP%E8%BF%9E%E6%8E%A5/" style="font-size: 10px;">HTTP连接</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Life/" style="font-size: 10px;">Life</a> <a href="/tags/POI/" style="font-size: 10px;">POI</a> <a href="/tags/RSA/" style="font-size: 10px;">RSA</a> <a href="/tags/nexus/" style="font-size: 10px;">nexus</a> <a href="/tags/restfull/" style="font-size: 10px;">restfull</a> <a href="/tags/sqlmap/" style="font-size: 10px;">sqlmap</a> <a href="/tags/sql%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">sql注入</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">前端</a> <a href="/tags/%E5%93%B2%E5%AD%A6/" style="font-size: 10px;">哲学</a> <a href="/tags/%E5%9B%A2%E9%98%9F%E7%AE%A1%E7%90%86/" style="font-size: 10px;">团队管理</a> <a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 10px;">安全</a> <a href="/tags/%E5%B7%A5%E4%BD%9C%E6%80%9D%E8%80%83/" style="font-size: 20px;">工作思考</a> <a href="/tags/%E5%B7%A5%E5%85%B7%E7%B1%BB/" style="font-size: 12px;">工具类</a> <a href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" style="font-size: 10px;">排序算法</a> <a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 14px;">缓存</a> <a href="/tags/%E8%AF%BB%E4%B9%A6/" style="font-size: 12px;">读书</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 18px;">读书笔记</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 16px;">随笔</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">January 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/01/12/%E4%BA%BA%E7%94%9F%E4%B8%AD%E5%94%AF%E4%B8%80%E7%9A%842024/">人生中唯一的2024</a>
          </li>
        
          <li>
            <a href="/2024/05/27/%E3%80%8A%E5%BE%B7%E7%B1%B3%E5%AE%89%EF%BC%9A%E5%BD%B7%E5%BE%A8%E5%B0%91%E5%B9%B4%E6%97%B6%E3%80%8B/">《德米安：彷徨少年时》</a>
          </li>
        
          <li>
            <a href="/2024/05/26/%E3%80%8A%E5%AE%9D%E8%B4%B5%E7%9A%84%E4%BA%BA%E7%94%9F%E5%BB%BA%E8%AE%AE%E3%80%8B/">《宝贵的人生建议》</a>
          </li>
        
          <li>
            <a href="/2024/03/17/%E3%80%8A%E7%AE%A1%E7%90%86%E7%9A%84%E5%AE%9E%E8%B7%B5%E3%80%8B/">《管理的实践》</a>
          </li>
        
          <li>
            <a href="/2024/02/24/%E3%80%8A%E5%8D%93%E6%9C%89%E6%88%90%E6%95%88%E7%9A%84%E7%AE%A1%E7%90%86%E8%80%85%E3%80%8B/">《卓有成效的管理者》</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2025 YiYing<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>